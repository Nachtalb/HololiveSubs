<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta content="width=device-width,initial-scale=1.0,user-scalable=yes,minimum-scale=1.0,maximum-scale=3.0" id="viewport" name="viewport">
  <meta content="#15181c" name="theme-color">

  <title>Hololive Subs Realtime</title>
  <link href="/icon.png" rel="shortcut icon" type="image/x-icon">

  <script src="/jquery-3.5.1.min.js" type="application/javascript"></script>
  <link href="/main.css" rel="stylesheet" />
</head>
<body>

  <main>
    <ul></ul>
  </main>
  <footer>Website created by <a href="https://nachtalb.io">Nachtalb</a>. Updated every 30min. Images are profile pictures from the respective twitter accounts.</footer>

  <script>
    function nFormatter(num, digits) {
      if (num === undefined) return;
      var si = [
        { value: 1, symbol: '' },
        { value: 1E3, symbol: 'k' },
        { value: 1E6, symbol: 'M' },
        { value: 1E9, symbol: 'G' },
        { value: 1E12, symbol: 'T' },
        { value: 1E15, symbol: 'P' },
        { value: 1E18, symbol: 'E' }
      ];
      var i, rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
      for (i = si.length - 1; i > 0; i--) {
        if (num >= si[i].value) {
          break;
        }
      }
      return (num / si[i].value).toFixed(digits).replace(rx, '$1') + si[i].symbol;
    }

    function loadSubs() {
      $.getJSON(window.location.href + 'stats', function(data){
        data.forEach(function(user){
          var element = $(`.${user.twitter}`),
              t_subs = nFormatter(user.t_subs, 1),
              yt_subs = nFormatter(user.yt_subs, 1),
              b_subs = nFormatter(user.b_subs, 1);

          if (element.length > 0) {
            element.find('.tFollowerCount span').text(t_subs);
            if (user.yt_subs) element.find('.ytFollowerCount span').text(yt_subs);
            if (user.b_subs) element.find('.bFollowerCount span').text(b_subs);
          }
          else {
            var html = `
              <li class="${user.twitter}" style="background-color: ${user.bg}; color: ${user.fg};">
                <a href="https://twitter.com/${user.twitter}" target="_blank">
                  <div class="img">
                    <img src="${user.image}"/>
                  </div>
                  <span class="name">${user.name}</span>
                </a>
                <div class="buttons">
                  {buttons}
                </div>
              </li>`

            var buttons = '';
            if (yt_subs)
              buttons += `
                    <a href="https://www.youtube.com/channel/${user.youtube}" class="ytFollowersCount followersCount" target="_blank">
                      <span>${yt_subs}</span> YouTube
                    </a>`;
            if (b_subs)
              buttons += `
                    <a href="https://space.bilibili.com/${user.bilibili}" class="bFollowersCount followersCount" target="_blank">
                      <span>${b_subs}</span> Bilibili
                    </a>
                    `
            buttons += `
                    <a href="https://twitter.com/${user.twitter}" class="tFollowersCount followersCount" target="_blank">
                      <span>${t_subs}</span> Twitter
                    </a>
                    `

            $('ul').append(html.replace('{buttons}', buttons))
          }
        });
      });
    }

    loadSubs();
    setInterval(function(){
      loadSubs();
    }, 1800000);
  </script>

</body>
</html>
